<!DOCTYPE html>
<html>
  <head>
    <title>Socket.IO chat</title>
     <script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
      <script src="/socket.io/socket.io.js"></script>

    <script>
        var socket = io("ws://localhost:3000");

        var myPics;
        var context;
        function InitThis() {

            let isDrawing = false;
            let x = 0;
            let y = 0;

            myPics  = document.getElementById('myCanvas');
            context = myPics.getContext('2d');


            myPics.addEventListener('mousedown', e => {
                x = e.offsetX;
                y = e.offsetY;
                isDrawing = true;
            });

            myPics.addEventListener('mousemove', e => {
                if (isDrawing === true) {
                    drawLine(context, x, y, e.offsetX, e.offsetY);
                    socket.emit('chat message',  {x: x,y:y ,offsetX: e.offsetX,offsetY:e.offsetY});
                    x = e.offsetX;
                    y = e.offsetY;
                }
            });

            window.addEventListener('mouseup', e => {
                if (isDrawing === true) {
                    drawLine(context, x, y, e.offsetX, e.offsetY);
                    socket.emit('chat message',  {x: x,y:y ,offsetX: e.offsetX,offsetY:e.offsetY});
                    x = 0;
                    y = 0;
                    isDrawing = false;
                }
            });


        }

        function drawLine(context, x1, y1, x2, y2) {
            context.beginPath();
            context.strokeStyle = 'black';
            context.lineWidth = 1;
            context.moveTo(x1, y1);
            context.lineTo(x2, y2);
            context.stroke();
            context.closePath();
        }


        socket.on('chat message', function(msg) {
            const {x,y,offsetX,offsetY} = msg;

            console.log('rescive',msg);
            drawLine(context, x, y, offsetX, offsetY);
        });


    </script>
  </head>
  <body onload = "InitThis()" >

    <canvas id="myCanvas" width="500" height="200" style="border:2px solid black"></canvas>


  </body>
</html>
